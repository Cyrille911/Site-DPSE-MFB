{% extends 'index.html' %}

{% block title %}Gestion des Activités{% endblock %}

{% block content %}
    <div class="container mt-5">
        <!-- Titre de la page -->
        <h1 class="mb-4 text-center">Gestion des Activités</h1>

        <!-- Bouton pour ajouter une nouvelle activité -->
        <div class="mb-3 text-end">
            <button class="btn btn-success" onclick="addActivity()">Ajouter une activité</button>
        </div>

        <!-- Tableau des activités -->
        <table class="table table-bordered table-striped" id="activitiesTable">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Nom de l'activité</th>
                    <th>Date de début</th>
                    <th>Date de fin</th>
                    <th>Statut</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Exemple d'activité -->
                <tr>
                    <td>1</td>
                    <td contenteditable="true">Préparer le rapport financier</td>
                    <td contenteditable="true">01/01/2025</td>
                    <td contenteditable="true">10/01/2025</td>
                    <td>
                        <select class="form-select form-select-sm" disabled>
                            <option value="En cours" selected>En cours</option>
                            <option value="Terminé">Terminé</option>
                            <option value="En attente">En attente</option>
                            <option value="Annulé">Annulé</option>
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteRow(this)">Supprimer</button>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- Bouton Enregistrer -->
        <div class="text-center mt-4">
            <button class="btn btn-primary btn-lg" onclick="saveActivities()">Enregistrer</button>
        </div>
    </div>

    <script>
        // Fonction pour ajouter une nouvelle activité
        function addActivity() {
            const table = document.getElementById('activitiesTable').getElementsByTagName('tbody')[0];
            const rowCount = table.rows.length + 1;

            // Crée une nouvelle ligne
            const newRow = table.insertRow();

            // Colonne ID
            const cell1 = newRow.insertCell(0);
            cell1.textContent = rowCount;

            // Colonne Nom de l'activité
            const cell2 = newRow.insertCell(1);
            cell2.contentEditable = "true";
            cell2.textContent = "Nouvelle activité";

            // Colonne Date de début
            const cell3 = newRow.insertCell(2);
            cell3.contentEditable = "true";
            cell3.textContent = "jj/mm/aaaa";

            // Colonne Date de fin
            const cell4 = newRow.insertCell(3);
            cell4.contentEditable = "true";
            cell4.textContent = "jj/mm/aaaa";

            // Colonne Statut
            const cell5 = newRow.insertCell(4);
            const select = document.createElement('select');
            select.classList.add('form-select', 'form-select-sm');
            select.disabled = true;
            select.innerHTML = `
                <option value="En cours">En cours</option>
                <option value="Terminé">Terminé</option>
                <option value="En attente">En attente</option>
                <option value="Annulé">Annulé</option>
            `;
            cell5.appendChild(select);

            // Colonne Actions
            const cell6 = newRow.insertCell(5);
            const deleteButton = document.createElement('button');
            deleteButton.classList.add('btn', 'btn-danger', 'btn-sm');
            deleteButton.textContent = "Supprimer";
            deleteButton.onclick = () => deleteRow(deleteButton);
            cell6.appendChild(deleteButton);
        }

        // Fonction pour supprimer une ligne
        function deleteRow(button) {
            const row = button.closest('tr');
            row.remove();

            // Réindexer les IDs après suppression
            const rows = document.getElementById('activitiesTable').getElementsByTagName('tbody')[0].rows;
            for (let i = 0; i < rows.length; i++) {
                rows[i].cells[0].textContent = i + 1;
            }
        }

        // Fonction pour enregistrer les activités
        function saveActivities() {
            const table = document.getElementById('activitiesTable');
            const rows = table.getElementsByTagName('tbody')[0].rows;
            const activities = [];

            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].cells;
                const activity = {
                    id: cells[0].textContent,
                    name: cells[1].textContent,
                    startDate: cells[2].textContent,
                    endDate: cells[3].textContent,
                    status: cells[4].getElementsByTagName('select')[0].value
                };
                activities.push(activity);
            }

            console.log("Activités enregistrées :", activities);
            alert("Les modifications ont été enregistrées !");
            // Vous pouvez envoyer `activities` au backend via une requête AJAX.
        }
    </script>

{% endblock %}
