{% extends 'index.html' %}

{% block title %}
Détails du Plan d'Action - {{ plan.titre }}
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center mb-4 text-primary fw-bold">Plan d'Action : {{ plan.titre }}</h1>

    <!-- Filtrage par Type d'Activité, Année, Effet, Produit, Action et Structure -->
    <form method="get" class="mb-4">
        <div class="row">
            <!-- Filtre par Type d'Activité -->
            <div class="col-md-4">
                <h4>Filtrer par Type d'Activité</h4>
                {% for activity_type in activity_types %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="type" value="{{ activity_type }}" 
                               {% if activity_type in selected_types %} checked {% endif %}>
                        <label class="form-check-label">{{ activity_type }}</label>
                    </div>
                {% endfor %}
            </div>

            <!-- Filtre par Année -->
            <div class="col-md-4">
                <h4>Filtrer par Année</h4>
                {% for year in available_years %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="annee" value="{{ year }}" 
                               {% if year|stringformat:"s" in selected_years %} checked {% endif %}>
                        <label class="form-check-label">{{ year }}</label>
                    </div>
                {% endfor %}
            </div>

            <!-- Filtre par Effet -->
            <div class="col-md-4">
                <h4>Filtrer par Effet</h4>
                {% for effet in available_effects %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="effet" value="{{ effet.id }}" 
                               {% if effet.id|stringformat:"s" in selected_effects %} checked {% endif %}>
                        <label class="form-check-label">{{ effet.titre }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="row">
            <!-- Filtre par Produit -->
            <div class="col-md-4">
                <h4>Filtrer par Produit</h4>
                {% for produit in available_products %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="produit" value="{{ produit.id }}" 
                               {% if produit.id|stringformat:"s" in selected_products %} checked {% endif %}>
                        <label class="form-check-label">{{ produit.titre }}</label>
                    </div>
                {% endfor %}
            </div>

            <!-- Filtre par Action -->
            <div class="col-md-4">
                <h4>Filtrer par Action</h4>
                {% for action in available_actions %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="action" value="{{ action.id }}" 
                               {% if action.id|stringformat:"s" in selected_actions %} checked {% endif %}>
                        <label class="form-check-label">{{ action.titre }}</label>
                    </div>
                {% endfor %}
            </div>

            <!-- Filtre par Structure -->
            <div class="col-md-4">
                <h4>Filtrer par Structure</h4>
                {% for structure in available_structures %}
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="structure" value="{{ structure }}" 
                               {% if structure in selected_structures %} checked {% endif %}>
                        <label class="form-check-label">{{ structure }}</label>
                    </div>
                {% endfor %}
            </div>
        </div>

        <button type="submit" class="btn btn-primary">Appliquer les filtres</button>
    </form>

    <!-- Affichage des activités par année -->
    {% for year, activites in activites_by_year.items %}
        <h4 class="text-center text-primary mt-4">Année {{ year }}</h4>
        <div class="table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Activité</th>
                        <th>Indicateur</th>
                        <th>Référence</th>
                        <th>Coût total</th>
                        <th>Type</th>
                        <th>Effet</th>
                        <th>Produit</th>
                        <th>Action</th>
                        <th>Structure</th>
                    </tr>
                </thead>
                <tbody>
                    {% for activite in activites %}
                        <tr>
                            <td>{{ activite.titre }}</td>
                            <td>{{ activite.indicator }}</td>
                            <td>{{ activite.reference }}</td>
                            <td>{{ activite.cout_total }}</td>
                            <td>{{ activite.type }}</td>
                            <td>{{ activite.effet }}</td>
                            <td>{{ activite.produit }}</td>
                            <td>{{ activite.action }}</td>
                            <td>{{ activite.structure }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endfor %}

    <!-- Bouton d'impression -->
    <div class="text-center mt-4">
        <button onclick="window.print()" class="btn btn-secondary">Imprimer cette page</button>
    </div>
</div>
{% endblock %}
