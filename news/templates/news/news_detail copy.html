{% extends 'index.html' %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h1 class="text-center mb-4 display-4">{{ news.headline }} ğŸ“°</h1>

                    <!-- Information de l'actualitÃ© -->
                    <div class="text-center mb-4 text-muted small">
                        <span class="me-3"><i class="fas fa-user"></i> {{ news.creator }} ğŸ‘¤</span>
                        <span><i class="fas fa-calendar-alt"></i> {{ news.published_at|date:"d M Y" }} ğŸ—“ï¸</span>
                    </div>
                    <div class="content">
                        <h4 class="text-primary">Contenu de l'actualitÃ© :</h4>
                        <style>
                            .news-image {
                                margin-right: 20px;  /* Ajustez la valeur selon vos besoins */
                            }
                        </style>
                        
                        <div class="d-flex align-items-center">
                            <!-- Image de l'actualitÃ© -->
                            <div class="news-image">
                                {% if news.image %}
                                    <img 
                                        src="{{ news.image.url }}" 
                                        class="card-img-top" 
                                        alt="{{ news.headline }}" 
                                        style="width: 150px; height: auto; object-fit: cover; border-radius: 5px;">
                                {% endif %}
                            </div>
                        
                            <!-- Texte principal -->
                            <div>
                                <h5 class="card-title">{{ news.headline }}</h5>
                                <p class="card-text">{{ news.content|truncatechars:15|safe }}</p>
                            </div>
                        </div>                        
                    </div>
                    <div class="mt-4 text-center">
                        {% if news.external_link %}   
                            <a href="{{ news.external_link }}" class="btn btn-primary me-3">Lien externe</a>                          
                        {% endif %}
                        {% if user.is_authenticated and news.creator == user %}
                            <a href="{% url 'edit_news' news.pk %}" class="btn btn-warning me-3">Modifier âœï¸</a>
                            <form action="{% url 'delete_news' news.pk %}" method="post" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Supprimer ğŸ—‘ï¸</button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Affichage des commentaires -->
            <div class="card shadow-sm border-0 mt-5">
                <div class="card-body">
                    <h4 class="text-primary">Commentaires ğŸ—¨ï¸</h4>
                    {% if comments %}
                    <ul class="list-unstyled mt-4">
                        {% for comment in comments %}
                            <li class="mb-4">
                                <div class="card shadow-sm border border-light p-3">
                                    <div class="d-flex align-items-center">
                                        {% if comment.user.photo %}
                                            <img src="{{ comment.user.photo.url }}" class="rounded-circle shadow-sm" width="50" height="50" alt="Photo">
                                        {% else %}
                                            <div class="rounded-circle bg-secondary text-white d-flex justify-content-center align-items-center shadow-sm"
                                                 style="width: 50px; height: 50px; font-size: 18px; font-weight: bold;">
                                                {{ comment.user.first_name|default:''|slice:":1" }}{{ comment.user.last_name|default:''|slice:":1" }}
                                            </div>
                                        {% endif %}
                                        <div class="ms-3">
                                            <h5 class="mt-0 mb-1">{{ comment.user.get_full_name }} ğŸ‘¤</h5>
                                            <small class="text-muted">{{ comment.created_at|date:"d M Y H:i" }} ğŸ•’</small>
                                        </div>
                                    </div>
                                    <p class="mt-3" id="comment-text-{{ comment.pk }}">{{ comment.content }} ğŸ’¬</p>
                
                                    {% if user == comment.user %}
                                        <!-- Permettre de modifier et de supprimer un commentaire -->
                                        <div class="d-flex mt-3">
                                            <button type="button" class="btn btn-warning btn-sm me-2 edit-comment" data-comment-id="{{ comment.pk }}" data-comment-content="{{ comment.content }}">Modifier âœï¸</button>
                                            <form action="{% url 'delete_newscomment' comment.pk %}" method="post" class="d-inline">
                                                {% csrf_token %}
                                                <button type="submit" class="btn btn-danger btn-sm">Supprimer ğŸ—‘ï¸</button>
                                            </form>
                                        </div>
                
                                        <!-- Formulaire d'Ã©dition du commentaire -->
                                        <div class="edit-form-container mt-3" id="edit-comment-{{ comment.pk }}" style="display: none;">
                                            <form method="POST" action="{% url 'edit_newscomment' comment.pk %}">
                                                {% csrf_token %}
                                                <textarea name="comment" rows="4" class="form-control mt-3">{{ comment.content }}</textarea>
                                                <button type="submit" class="btn btn-primary mt-3">Enregistrer ğŸ“</button>
                                            </form>
                                        </div>
                                    {% endif %}
                                </div>
                            </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                        <p class="text-muted text-center mt-4">Aucun commentaire pour cette actualitÃ©. ğŸ¤”</p>
                    {% endif %}
                </div>
            </div>

            <!-- Formulaire de commentaire -->
            <div class="card shadow-sm border-0 mt-5">
                <div class="card-body">
                    {% if user.is_authenticated %}
                        <h4 class="text-primary">Laisser un commentaire ğŸ’¬</h4>
                        <form action="{% url 'add_newscomment' news.pk %}" method="POST" id="add_comment">
                            {% csrf_token %}
                            <textarea name="comment" rows="4" class="form-control mt-3" placeholder="Votre commentaire ici... ğŸ˜Š" required></textarea>
                            <button type="submit" class="btn btn-primary mt-3 w-100">Ajouter le commentaire ğŸ“</button>
                        </form>
                    {% else %}
                        <p class="text-muted text-center"><a href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Connectez-vous</a> pour laisser un commentaire ğŸ”’.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Bouton retour -->
            <div class="mt-4 text-center">
                <a href="{% url 'news_list' %}" class="btn btn-info">Retour ğŸ”™</a>
            </div>
        </div>
    </div>
</div>

<script>
    // JavaScript pour afficher le formulaire d'Ã©dition de commentaire
    const editButtons = document.querySelectorAll('.edit-comment');
    
    editButtons.forEach(button => {
        button.addEventListener('click', function() {
            const commentId = this.getAttribute('data-comment-id');
            const formContainer = document.getElementById(`edit-comment-${commentId}`);
            const commentText = document.getElementById(`comment-text-${commentId}`);

            // Toggle l'affichage du formulaire d'Ã©dition
            formContainer.style.display = formContainer.style.display === 'none' ? 'block' : 'none';
            commentText.style.display = commentText.style.display === 'none' ? 'block' : 'none';
        });
    });
</script>

{% endblock %}
